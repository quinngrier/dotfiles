#! /bin/sh -
#
# Usage: git c <message> [<arg>...]
#
# Makes a commit with the given <message>, failing if the subject line
# is longer than 50 characters. Any additional arguments are passed
# through to the underlying git commit command.
#

case $# in
  0)
    cat >&2 <<'EOF'
Usage: git c <message> [<arg>...]

Makes a commit with the given <message>, failing if the subject line is
longer than 50 characters. Any additional arguments are passed through
to the underlying git commit command.
EOF
    exit 1
  ;;
esac

git=${_:?}

message=$1
shift

excess=`awk 'NR == 1 { if (length > 50) print length - 50 }' <<EOF
$message
EOF
` || exit $?
readonly excess

case $excess in
  1)
    printf 'Subject line is 1 character too long.\n' >&2
    exit 1
  ;;
  ?*)
    printf 'Subject line is %d characters too long.\n' $excess >&2
    exit 1
  ;;
esac

case $# in
  0) "$git" commit -m "$message"      || exit $? ;;
  *) "$git" commit -m "$message" "$@" || exit $? ;;
esac

#
# The authors of this file have waived all copyright and
# related or neighboring rights to the extent permitted by
# law as described by the CC0 1.0 Universal Public Domain
# Dedication. You should have received a copy of the full
# dedication along with this file, typically as a file
# named <CC0-1.0.txt>. If not, it may be available at
# <https://creativecommons.org/publicdomain/zero/1.0/>.
#
